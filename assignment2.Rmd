---
title: "assignment2"
author: "Cade Garcia"
date: "2025-08-07"
output: html_document
---

```{r}
library(shiny)
library(mapgl)
library(here)
library(sf)
library(viridis)
library(tidyverse)
library(bslib)
```

```{r}
county_data <- st_read(here("data/county_data.gpkg"))
```

```{r}
glimpse(county_data)
```

```{r}
available_languages <- sort(unique(county_data$language))
```

```{r}
ui <- page_sidebar(
  title = "Languages by County (Percent Speakers)",
  sidebar = sidebar(
    selectInput("language", "Choose a Language:", choices = available_languages)
  ),
  card(
    full_screen = TRUE,
    maplibreOutput("map", height = "100vh")
  )
)

server <- function(input, output, session) {
  filtered_data <- reactive({
    county_data %>%
      filter(language == input$language, !is.na(percent_speakers))
  })

  output$map <- renderMaplibre({
    data <- filtered_data()
    req(nrow(data) > 0)

    # Range for interpolation
    min_val <- min(data$percent_speakers, na.rm = TRUE)
    max_val <- max(data$percent_speakers, na.rm = TRUE)

    maplibre(style = carto_style("positron")) |>
      fit_bounds(data, animate = FALSE) |>
      add_fill_layer(
        id = "language_layer",
        source = data,
        fill_color = interpolate(
          column = "percent_speakers",
          values = c(min_val, max_val),
          stops = c("lightblue", "darkblue"),
          na_color = "lightgrey"
        ),
        fill_opacity = 0.7
      )
  })
}

shinyApp(ui, server)
```
